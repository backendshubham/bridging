<div class="section">
    <div class="container">
        <div class="product-detail">
            <div class="product-detail-header">
                <div class="product-detail-image-container">
                    <!-- Image Carousel -->
                    <div class="product-carousel-wrapper">
                        <div class="product-carousel" id="productCarousel">
                            <% 
                            let allImages = [];
                            if (gemstone.primary_image) {
                                allImages.push(gemstone.primary_image);
                            }
                            if (gemstone.image_gallery && gemstone.image_gallery.length > 0) {
                                allImages = allImages.concat(gemstone.image_gallery);
                            }
                            %>
                            <% if (allImages.length > 0) { %>
                                <% allImages.forEach(function(img, index) { %>
                                    <div class="carousel-slide <%= index === 0 ? 'active' : '' %>">
                                        <img src="<%= img %>" alt="<%= gemstone.name %>" class="product-detail-image">
                                    </div>
                                <% }); %>
                            <% } else { %>
                                <div class="carousel-slide active">
                                    <div class="product-detail-image" style="display: flex; align-items: center; justify-content: center; font-size: 8rem; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 500px; color: #667eea;"><i class="fas fa-gem"></i></div>
                                </div>
                            <% } %>
                        </div>
                        
                        <!-- Carousel Controls -->
                        <% if (allImages.length > 1) { %>
                            <button class="carousel-btn carousel-prev" onclick="changeSlide(-1)" aria-label="Previous image">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="carousel-btn carousel-next" onclick="changeSlide(1)" aria-label="Next image">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                            
                            <!-- Carousel Indicators -->
                            <div class="carousel-indicators">
                                <% allImages.forEach(function(img, index) { %>
                                    <span class="carousel-indicator <%= index === 0 ? 'active' : '' %>" onclick="goToSlide(<%= index %>)"></span>
                                <% }); %>
                            </div>
                            
                            <!-- Thumbnail Gallery -->
                            <div class="product-gallery-thumbs">
                                <% allImages.forEach(function(img, index) { %>
                                    <img src="<%= img %>" alt="<%= gemstone.name %>" class="gallery-thumb <%= index === 0 ? 'active' : '' %>" onclick="goToSlide(<%= index %>)">
                                <% }); %>
                            </div>
                        <% } %>
                    </div>
                </div>

                <div class="product-detail-info">
                    <div style="margin-bottom: 1rem;">
                        <span class="badge badge-info" style="font-size: 0.75rem; padding: 0.5rem 1rem;">SKU: <%= gemstone.sku %></span>
                    </div>
                    <h1><%= gemstone.name %></h1>
                    
                    <% if (gemstone.category_name) { %>
                        <p style="color: #718096; font-size: 1rem; margin-bottom: 1.5rem; font-weight: 500;">
                            Category: <strong style="color: #667eea;"><%= gemstone.category_name %></strong>
                        </p>
                    <% } %>

                    <div class="product-detail-specs">
                        <div class="spec-item">
                            <span class="spec-label">Ratna Type</span>
                            <span class="spec-value"><%= gemstone.ratna_type %></span>
                        </div>
                        <div class="spec-item">
                            <span class="spec-label">Carat Weight</span>
                            <span class="spec-value"><%= gemstone.carat_weight %> ct</span>
                        </div>
                        <% if (gemstone.color_grade) { %>
                            <div class="spec-item">
                                <span class="spec-label">Color Grade</span>
                                <span class="spec-value"><%= gemstone.color_grade %></span>
                            </div>
                        <% } %>
                        <% if (gemstone.clarity) { %>
                            <div class="spec-item">
                                <span class="spec-label">Clarity</span>
                                <span class="spec-value"><%= gemstone.clarity %></span>
                            </div>
                        <% } %>
                        <% if (gemstone.cut) { %>
                            <div class="spec-item">
                                <span class="spec-label">Cut</span>
                                <span class="spec-value"><%= gemstone.cut %></span>
                            </div>
                        <% } %>
                        <% if (gemstone.shape) { %>
                            <div class="spec-item">
                                <span class="spec-label">Shape</span>
                                <span class="spec-value"><%= gemstone.shape %></span>
                            </div>
                        <% } %>
                        <% if (gemstone.origin) { %>
                            <div class="spec-item">
                                <span class="spec-label">Origin</span>
                                <span class="spec-value"><%= gemstone.origin %></span>
                            </div>
                        <% } %>
                    </div>

                    <div class="product-price-section">
                        <div class="price-main">₹<%= parseFloat(gemstone.final_price).toLocaleString('en-IN') %></div>
                        <div class="price-per-carat">₹<%= parseFloat(gemstone.price_per_carat).toLocaleString('en-IN') %> per carat</div>
                        <% if (gemstone.discount_percentage > 0) { %>
                            <div class="discount-badge">
                                <i class="fas fa-tag" style="margin-right: 0.5rem;"></i>
                                Save <%= gemstone.discount_percentage %>% 
                                <% if (gemstone.total_price) { %>
                                    <span class="discount-old-price">
                                        (Was ₹<%= parseFloat(gemstone.total_price).toLocaleString('en-IN') %>)
                                    </span>
                                <% } %>
                            </div>
                        <% } %>
                    </div>

                    <% if (gemstone.certificate_type) { %>
                        <div class="certificate-badge">
                            <i class="fas fa-certificate"></i>
                            <span><%= gemstone.certificate_type %> Certified</span>
                        </div>
                        <div class="certificate-details-box">
                            <p class="certificate-details-title">Certification Details:</p>
                            <div class="certificate-details-content">
                                <p><strong>Type:</strong> <%= gemstone.certificate_type %></p>
                                <% if (gemstone.certificate_number) { %>
                                    <p><strong>Certificate Number:</strong> <%= gemstone.certificate_number %></p>
                                <% } %>
                                <% if (gemstone.certificate_link) { %>
                                    <a href="<%= gemstone.certificate_link %>" target="_blank" class="certificate-link-btn">
                                        <i class="fas fa-external-link-alt" style="margin-right: 0.5rem;"></i>
                                        View Certificate
                                    </a>
                                <% } %>
                            </div>
                        </div>
                    <% } %>

                    <% if (gemstone.description) { %>
                        <div style="margin-top: 2rem; padding: 1.5rem; background: #f8f9fa; border-radius: 12px;">
                            <h3 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 1rem; color: #1a1a1a;">Description</h3>
                            <p style="color: #4a5568; line-height: 1.8;"><%= gemstone.description %></p>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>

        <div style="text-align: center; margin-top: 3rem;">
            <a href="/catalog" class="btn-back-catalog">
                <i class="fas fa-arrow-left"></i>
                <span>Back to Catalog</span>
            </a>
        </div>
    </div>
</div>

<script>
let currentSlide = 0;
<% 
let allImages = [];
if (gemstone.primary_image) {
    allImages.push(gemstone.primary_image);
}
if (gemstone.image_gallery && gemstone.image_gallery.length > 0) {
    allImages = allImages.concat(gemstone.image_gallery);
}
%>
const totalSlides = <%= allImages.length || 1 %>;

function changeSlide(direction) {
    currentSlide += direction;
    
    if (currentSlide < 0) {
        currentSlide = totalSlides - 1;
    } else if (currentSlide >= totalSlides) {
        currentSlide = 0;
    }
    
    goToSlide(currentSlide);
}

function goToSlide(index) {
    currentSlide = index;
    
    // Update slides
    const slides = document.querySelectorAll('.carousel-slide');
    slides.forEach((slide, i) => {
        slide.classList.toggle('active', i === index);
    });
    
    // Update indicators
    const indicators = document.querySelectorAll('.carousel-indicator');
    indicators.forEach((indicator, i) => {
        indicator.classList.toggle('active', i === index);
    });
    
    // Update thumbnails
    const thumbs = document.querySelectorAll('.gallery-thumb');
    thumbs.forEach((thumb, i) => {
        thumb.classList.toggle('active', i === index);
    });
}

// Keyboard navigation
document.addEventListener('keydown', function(e) {
    if (e.key === 'ArrowLeft') {
        changeSlide(-1);
    } else if (e.key === 'ArrowRight') {
        changeSlide(1);
    }
});

// Auto-play carousel (optional - can be disabled)
// let autoPlayInterval = setInterval(() => changeSlide(1), 5000);

// Pause on hover
const carouselWrapper = document.querySelector('.product-carousel-wrapper');
if (carouselWrapper) {
    carouselWrapper.addEventListener('mouseenter', () => {
        // clearInterval(autoPlayInterval);
    });
    carouselWrapper.addEventListener('mouseleave', () => {
        // autoPlayInterval = setInterval(() => changeSlide(1), 5000);
    });
}
</script>
